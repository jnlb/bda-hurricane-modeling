---
title: "BDA Project: Hurricane forecasting in Stan"
author: | 
  | José Miguel Ramírez & Jonas Lindblad
  | Aalto University
output: 
    beamer_presentation:
        incremental: true
header-includes:
  \usepackage{dcolumn}
---

<!-- 1. introduce the problem we are trying to solve -->
## Hurricane introduction

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = '..')
```


```{r, include=FALSE}
source("init.r", local = knitr::knit_global())

# images
hurricane <- file.path(getwd(), img_path, "hurricane.jpg")
path <- file.path(getwd(), img_path, "corrplot_delta_small_presentation_centered.png")

# diagrams
regression_diag <- file.path(getwd(), img_path, "simple_regression.png")
skew_diag <- file.path(getwd(), img_path, "skew_regression.png")
variance_diag <- file.path(getwd(), img_path, "variance_regression.png")

# ships variables
ships_no <- file.path(getwd(), img_path, "ships_img.png")
ships_time <- file.path(getwd(), img_path, "ships_img_time.png")
ships_vars <- file.path(getwd(), img_path, "ships_img_vars.png")

# pareto-k plots
pareto_linear_path <- file.path(getwd(), img_path, "pareto_linear.png")
pareto_skew_path <- file.path(getwd(), img_path, "pareto_skew.png")
pareto_variance_path <- file.path(getwd(), img_path, "pareto_variance.png")

# forecast plots 
dorian <- file.path(getwd(), img_path, "eval_dorian2.png")
chris <- file.path(getwd(), img_path, "eval_chris2.png")
florence <- file.path(getwd(), img_path, "eval_florence2.png")
gabrielle <- file.path(getwd(), img_path, "eval_gabrielle2.png")
helene <- file.path(getwd(), img_path, "eval_helene2.png")
isaac <- file.path(getwd(), img_path, "eval_isaac2.png")
jose <- file.path(getwd(), img_path, "eval_jose2.png")
```
<!-- note that for syntax reasons there needs to be a space '- ' -->
- Destructive storms occuring in the late summer and fall in the northern hemisphere’s tropical region.   
- Classified by their wind intensity at the eye wall.  
- They can cause extreme levels of flooding and destroy many buildings.  
- Monetary damages and loss of lives increase with an almost exponential character as a function of storm intensity.  

\center

![](`r hurricane`){width=60%}


## Hurricane forecasting basics

- Forecasters predict two quantities: track and intensity
- Two kinds of models: _dynamical_ and _statistical_
    - Dynamical: simulate the laws of physics
    - Statistical: estimate based on historical data
- Dynamical vs. statistical: good at long- and short-range forecasts respectively
- ...but for hurricane forecasts short-range is usually more interesting
- _Rapid intensification_: forecasted better by dynamical models
- This project: a _statistical_ model for _intensity_

<!-- 1.1. needed a longer explanation for this part... -->
## Hurricane forecasting basics: the SHIPS data

The US government forecasting agency, the National Hurricane Center (NHC), uses a large number of models operationally. The models (together: the _model ensemble_) are used together with experienced meteorologists' judgment to provide the official forecast. 

- Surprisingly, the best _single_ (short-range) model is a multiple linear regression!
- The NHC regression model: Statistical Hurricane Intensity Prediction Scheme (SHIPS)
- SHIPS: ~140 covariates, many calculated from data sources more easily available to the NHC
- SHIPS dataset: publically available with no restrictions (link: [SHIPS Development](http://rammb.cira.colostate.edu/research/tropical_cyclones/ships/index.asp))
- ...but the documentation is terrible
- SHIPS: only a point estimate; our project: a predictive distribution

<!-- 1.2-a. an image explaining the variable set we have used -->
## Hurricane forecasting basics: the SHIPS data

The SHIPS developmental data is confusing!

![](`r ships_no`){width=100%}

## Hurricane forecasting basics: the SHIPS data

We are making _synoptic_ models.

![](`r ships_time`){width=100%}

## Hurricane forecasting basics: the SHIPS data

We are making _synoptic_ models and choosing variables.

![](`r ships_vars`){width=100%}

<!-- 1.2-b. correlation plot ? -->
## Hurricane forecasting basics: our selection

We have not done statistical variable selection. Choice of variable subset is based on theory.

>- **CSST**: (climatological) sea surface temperature
>- **RHLO**: low-altitude relative humidity
>- **T200**: air temperature at 200 mb (very high altitude)
>- **SHRD**: wind shear between 850 and 200 mb
>- **VMPI**: maximum potential intensity

:::: {.columns}
::: {.column width="40%"}
![](`r path`){width=90%}
:::
::: {.column width="60%"}
>- for testing, we have variable sets *A, B, C*
>- *A*: LAT/LON, VMAX, CSST, SHRD
>- *B*: LAT/LON, VMAX, CSST, SHRD, VMPI
>- *C*: LAT/LON, VMAX, CSST, SHRD, VMPI, RHLO, T200
:::
::::

<!-- 2. explain the 3 models; visually rather than with text -->
<!-- idea: Kruschke diagrams -->
<!-- https://github.com/rasmusab/distribution_diagrams -->
<!-- we would need 3 different Kruschke diagrams for the models -->
## Intensity change predictive model

The SHIPS Blunder: a simple linear regression

![](`r regression_diag`){width=100%}

## Intensity change predictive model

Model 2: regression with skewness

- errors not symmetric around the mean prediction!
- rapid intensification!

![](`r skew_diag`){width=80%}

## Intensity change predictive model

Model 3: regression with a linear model for standard deviation

- fewer storms reach higher values of `VMAX` 
- allow for higher variance to account for larger historical uncertainty

![](`r variance_diag`){width=80%}

<!-- 2.1. some remarks on limits of the model(s) -->
## Models: some remarks

- SHIPS: predict $V_{max}$; our models: predict $\Delta V_{max}$
- we also decided to include latitude and longitude as variables; geographic region is known to be important for storm development
- reminder: we do 12-hour forecasts
- we standardized all of our data; priors chosen to be weak in standardized scale
- SHIPS data: 1982-2019; our restriction: 2017-2019
- poor problem setup! True model is the laws of physics, but we are fitting a regression
- models were programmed in Stan; sampling with `rstan` resulted in no divergences or issues except for the skew model and the issue was solved by increasing max tree depth to 15

<!-- 3.1.1 compare with other models -->
## Forecasting: Model Comparison (1)

\vspace{0.4cm}

Dataset comparison for the **linear regression model** (LOOCV)  

\vspace{0.1cm}

\begin{table}[!h]
\fontsize{8pt}{12pt}\selectfont
\begin{tabular}{ c c c }
 Dataset & \textbf{elpd\_diff} & \textbf{se\_diff} \\ \hline
 \textbf{\textit{C}} & 0.0 & 0.0 \\  
 \textit{B} & -25.0 & 6.5 \\  
 \textit{A} & -27.4 & 6.3 \\     
\end{tabular}
\end{table}

\vspace{-0.2cm}

\center
![](`r pareto_linear_path`){height=60%}

<!-- 3.1.2 compare with other models -->
## Forecasting: Model Comparison (2)

\vspace{0.4cm}

Dataset comparison for the **skewed regression model** (LOOCV)  

\vspace{0.1cm}

\begin{table}[!h]
\fontsize{8pt}{12pt}\selectfont
\begin{tabular}{ c c c }
 Dataset & \textbf{elpd\_diff} & \textbf{se\_diff} \\ \hline
 \textbf{\textit{C}} & 0.0 & 0.0 \\  
 \textit{B} & -23.2 & 6.2 \\  
 \textit{A} & -28.7 & 6.2 \\     
\end{tabular}
\end{table}


\vspace{-0.2cm}
\center
![](`r pareto_skew_path`){height=60%}

<!-- 3.1.3 compare with other models -->
## Forecasting: Model Comparison (3)

\vspace{0.4cm}

Dataset comparison for the **Changing variance model** (LOOCV)  

\vspace{0.1cm}  

\begin{table}[!h]
\fontsize{8pt}{12pt}\selectfont
\begin{tabular}{ c c c }
 Dataset & \textbf{elpd\_diff} & \textbf{se\_diff} \\ \hline
 \textbf{\textit{C}} & 0.0 & 0.0 \\  
 \textit{B} & -32.6 & 8.2 \\  
 \textit{A} & -37.1 & 8.2 \\     
\end{tabular}
\end{table}


\vspace{-0.2cm}
\center
![](`r pareto_variance_path`){height=60%}

<!-- 3.1.4 compare with other models -->
## Forecasting: Model Comparison (4)

Model comparison using the Dataset C (LOOCV) 
\vspace{1cm}

\begin{table}[!h]
\renewcommand{\arraystretch}{1.25}
\begin{tabular}{ c c c }
 Model & \textbf{elpd\_diff} & \textbf{se\_diff} \\ \hline
 \textbf{Variance} & 0.0 & 0.0 \\  
 Skew & -176.3 & 27.8 \\  
 Linear & -205.5 & 34.9 \\     
\end{tabular}
\end{table}

<!-- Marginal plot for the theta-variables -->
## Marginal posteriors

>- $\theta_1$: constant term
>- $\theta_2, \theta_3$: latitude, longitude
>- $\theta_4$: sea surface temperature (CSST)
>- $\theta_5$: relative humidity (RHLO)
>- $\theta_6$: wind shear (SHRD)
>- $\theta_7$: maximum potential intensity (VMPI)
>- $\theta_8$: air temperature at 200 mb (T200)
>- $\theta_9$: intensity at storm core (VMAX)

<!-- 3.2. try looking for historical NHC predictions? (can be skimmed incase of time running out) -->
## Forecasting: posterior predictive checks

Hurricane Dorian 2019. The image shows a 90% credible interval. Black dotted line: true VMAX
\center

![](`r dorian`){height=70%}

## Forecasting: posterior predictive checks

Hurricane Florence 2018. The image shows a 90% credible interval. Black dotted line: true VMAX
\center

![](`r florence`){height=70%}

## Forecasting: posterior predictive checks

Hurricane Helene 2018. The image shows a 90% credible interval. Black dotted line: true VMAX
\center

![](`r helene`){height=70%}

<!-- 4. Final section -->
## Problems to solve & development ideas

- variable selection in full SHIPS dataset
- more time series autoregressive components
- use LGEM model (will explain)


<!-- 4.1. Conclusions  -->
## Conclusions & contact info
<!-- don't put your email address directly : github crawlers will find it and send you spam -->


<!-- 4.2 Extra material -->
## Additional information

<!-- We need to consider what questions the TAs are likely to ask -->

<!-- Consider including an image which explains how Hurricanes form -->
